<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Christmas - Final Clean</title>
    
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="spinner"></div>
        <div class="loading-text">ğŸ„ Loading Magic Christmas ğŸ„</div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">0%</div>
    </div>

    <!-- Error Message (hidden by default) -->
    <div id="error-message" class="error-message" style="display: none;">
        <h2>âš ï¸ Error</h2>
        <p id="error-details"></p>
        <button onclick="location.reload()">Reload Page</button>
    </div>

    <div id="error-log"></div>
    
    <!-- V Gesture Trail Canvas (for drawing sparkle trail) -->
    <canvas id="v-trail-canvas"></canvas>
    
    <!-- V Gesture Hint - Enhanced -->
    <div id="v-gesture-hint">
        <!-- Floating particles inside -->
        <div class="hint-particles">
            <span class="particle p1">âœ¨</span>
            <span class="particle p2">â­</span>
            <span class="particle p3">â„</span>
            <span class="particle p4">âœ¨</span>
            <span class="particle p5">ğŸŒŸ</span>
            <span class="particle p6">â„</span>
            <span class="particle p7">âœ¨</span>
            <span class="particle p8">â­</span>
        </div>
        
        <!-- Glowing orbs -->
        <div class="glow-orb orb1"></div>
        <div class="glow-orb orb2"></div>
        <div class="glow-orb orb3"></div>
        
        <div class="v-hint-icon">âœŒï¸</div>
        <div class="v-hint-text">Váº½ chá»¯ <span class="v-letter">V</span> Ä‘á»ƒ báº¯t Ä‘áº§u phÃ©p mÃ u</div>
        <div class="v-hint-subtext">~ Draw a V in the air to start the magic ~</div>
        <div class="v-hint-animation">
            <svg viewBox="0 0 100 80" class="v-shape-svg">
                <defs>
                    <linearGradient id="vGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#FFD700"/>
                        <stop offset="50%" style="stop-color:#FF6347"/>
                        <stop offset="100%" style="stop-color:#32CD32"/>
                    </linearGradient>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <path class="v-path" d="M 10 10 L 50 70 L 90 10" fill="none" stroke="url(#vGradient)" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" filter="url(#glow)"/>
            </svg>
        </div>
        <div class="v-hint-instruction">
            <span class="instruction-arrow">â† xuá»‘ng â†“ lÃªn â†’</span>
        </div>
    </div>
    
    <!-- Controls Toggle Button -->
    <div id="toggle-controls" onclick="toggleControls()" title="Toggle Controls">âš™ï¸</div>
    
    <!-- Controls Panel -->
    <div id="controls-panel">
        <div class="control-group">
            <button class="control-btn" id="btnMute" onclick="toggleMute()">
                <span id="mute-icon">ğŸ”Š</span> <span id="mute-text">Mute</span>
            </button>
        </div>
        
        <div class="control-group">
            <label class="control-label">Volume</label>
            <div class="volume-container">
                <input type="range" class="volume-slider" id="volumeSlider" 
                       min="0" max="100" value="100" oninput="setVolume(this.value)">
                <span class="volume-value" id="volumeValue">100%</span>
            </div>
        </div>
        
        <div class="control-group">
            <button class="control-btn" onclick="toggleFullscreen()">
                <span id="fullscreen-icon">ğŸ—–</span> <span id="fullscreen-text">Fullscreen</span>
            </button>
        </div>
        
        <div class="control-group">
            <button class="control-btn" onclick="resetScene()">
                ğŸ”„ Reset
            </button>
        </div>
    </div>
    
    <div id="ui-layer">
        <div class="guide" id="guide-text">
            ğŸ– <b>Open:</b> Explode &nbsp;|&nbsp; ğŸ«¶ <b>Heart:</b> Love &nbsp;|&nbsp; âœŠ <b>Fist:</b> Tree
        </div>
        <!-- Fallback button (hidden by default, shown if camera fails) -->
        <button id="btnStart" onclick="startSystem()" style="display: none;">START MAGIC</button>
    </div>

    <div id="canvas-container"></div>
    <video class="input_video" style="display:none"></video>
    <canvas id="camera-preview"></canvas>

    <!-- JavaScript Files -->
    <script src="js/config.js"></script>
    <script src="js/loader.js"></script>
    <script src="js/resources.js"></script>
    <script src="js/scene.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/keyboard.js"></script>
    <script src="js/vgesture.js"></script>
    <script src="js/hands.js"></script>
    
    <!-- Initialize V gesture detection when page loads -->
    <script>
        // Wait for all resources to load, then start V gesture detection
        window.addEventListener('load', function() {
            // Wait a bit for MediaPipe to fully initialize
            setTimeout(function() {
                if (typeof initPreStartCamera === 'function') {
                    initPreStartCamera();
                }
            }, 1000);
        });
    </script>
</body>
</html>
